<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>ServoSide.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">rc-car</a> &gt; <a href="../index.html" class="el_bundle">rc-drivecontrol</a> &gt; <a href="index.source.html" class="el_package">org.rcdukes.car</a> &gt; <span class="el_source">ServoSide.java</span></div><h1>ServoSide.java</h1><pre class="source lang-java linenums">package org.rcdukes.car;

import org.rcdukes.common.ServoPosition;

/**
 * a side of a servo e.g. left/right or forward/reverse
 * 
 * @author wf
 *
 */
public class ServoSide {
  ServoPosition min;
  ServoPosition max;
  double polarity;
  String name;

  public ServoPosition getMin() {
<span class="nc" id="L18">    return min;</span>
  }

  public void setMin(ServoPosition min) {
<span class="nc" id="L22">    this.min = min;</span>
<span class="nc" id="L23">  }</span>

  public ServoPosition getMax() {
<span class="nc" id="L26">    return max;</span>
  }

  public void setMax(ServoPosition max) {
<span class="nc" id="L30">    this.max = max;</span>
<span class="nc" id="L31">  }</span>

  public double getPolarity() {
<span class="nc" id="L34">    return polarity;</span>
  }

  public void setPolarity(double polarity) {
<span class="nc" id="L38">    this.polarity = polarity;</span>
<span class="nc" id="L39">  }</span>

  public String getName() {
<span class="nc" id="L42">    return name;</span>
  }

  public void setName(String name) {
<span class="nc" id="L46">    this.name = name;</span>
<span class="nc" id="L47">  }</span>

  /**
   * create a servo side
   * @param name
   * @param polarity
   * @param min
   * @param max
   */
  public ServoSide(String name,double polarity,ServoPosition min, ServoPosition max) {
<span class="nc" id="L57">    super();</span>
<span class="nc" id="L58">    this.name=name;</span>
<span class="nc" id="L59">    this.polarity=polarity;</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">    if (polarity&gt;0) {</span>
<span class="nc" id="L61">      this.min = min;</span>
<span class="nc" id="L62">      this.max = max;</span>
    } else {
<span class="nc" id="L64">      this.min=max;</span>
<span class="nc" id="L65">      this.max=min;</span>
    }
<span class="nc" id="L67">  }</span>

  /**
   * make sure the servo Value stays within the valid bounds
   * @param value
   * @return - the clamped valud
   */
  public double clampValue(double value) {
<span class="nc bnc" id="L75" title="All 2 branches missed.">    if (value &lt; min.getValue())</span>
<span class="nc" id="L76">      return min.getValue();</span>
<span class="nc bnc" id="L77" title="All 2 branches missed.">    else if (value &gt; max.getValue())</span>
<span class="nc" id="L78">      return max.getValue();</span>
    else
<span class="nc" id="L80">      return value;</span>
  }

  /**
   * make sure the servo position stays within the valid bounds
   * @param pos
   * @return the clamped servo position
   */
  public int clampServoPos(long pos) {
<span class="nc" id="L89">    int servoPos=(int) pos;</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">    if (servoPos &lt; min.getServoPos())</span>
<span class="nc" id="L91">      return min.getServoPos();</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">    else if (servoPos &gt; max.getServoPos())</span>
<span class="nc" id="L93">      return max.getServoPos();</span>
    else
<span class="nc" id="L95">      return servoPos;</span>
  }

  /**
   * interpolate a servo position based on the given percentage
   * 
   * @param percent
   * @return a servoPosition
   */
  public ServoPosition interpolate(double percent) {
<span class="nc" id="L105">    double factor=this.percentToFactor(percent);</span>
<span class="nc" id="L106">    int pos=interpolateServoPos(factor);</span>
<span class="nc" id="L107">    double value=interpolateValue(factor);</span>
<span class="nc" id="L108">    ServoPosition servoPos = new ServoPosition(pos,value);</span>
<span class="nc" id="L109">    return servoPos;</span>
  }
  
  /**
   * convert the given percent value to a factor
   * @param percent - the percent value
   * @return - the factor to use
   */
  public double percentToFactor(double percent) {
<span class="nc" id="L118">    double factor=Math.abs(percent)/100;</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">    if (polarity&lt;0)</span>
<span class="nc" id="L120">      factor=1-factor;</span>
<span class="nc" id="L121">    return factor;</span>
  }
  
  /**
   * interpolate the servo position with the given factor
   * @param factor
   * @return - a new servoPos setting
   */
  public int interpolateServoPos(double factor) {
<span class="nc" id="L130">    double posRange = (max.getServoPos() - min.getServoPos());</span>
<span class="nc" id="L131">    double pPos = min.getServoPos() + posRange * factor;</span>
<span class="nc" id="L132">    return clampServoPos(Math.round(pPos));</span>
  }
  
  /**
   * get the value Range
   * @return
   */
  public double valueRange() {
<span class="nc" id="L140">    double valueRange = (max.getValue() - min.getValue());</span>
<span class="nc" id="L141">    return valueRange;</span>
  }
  
  /**
   * interpolate the value with the given factor
   * @param factor
   * @return - the new value
   */
  public double interpolateValue(double factor) {
<span class="nc" id="L150">    double pVal = min.getValue() + valueRange() *factor;</span>
<span class="nc" id="L151">    return clampValue(pVal);</span>
  }
  
  /**
   * interpolate a value from the given servo position
   * @param spos
   * @return - the interpolated value
   */
  public double interpolateValueFromPos(int spos) {
<span class="nc" id="L160">    double posRange = (max.getServoPos() - min.getServoPos());</span>
<span class="nc" id="L161">    double factor=(spos-min.getServoPos())/posRange;</span>
<span class="nc" id="L162">    double result=interpolateValue(factor);</span>
<span class="nc" id="L163">    return result;</span>
  }
  
  /**
   * check whether the serviOis is on this Side
   * @param servoPos
   * @return - true if the servoPos is on this Side
   */
  public boolean isServoPosOnSide(int servoPos) {
<span class="nc" id="L172">    boolean in=false;</span>
<span class="nc" id="L173">    int maxp=Math.max(max.getServoPos(),min.getServoPos());</span>
<span class="nc" id="L174">    int minp=Math.min(max.getServoPos(),min.getServoPos());</span>
<span class="nc bnc" id="L175" title="All 4 branches missed.">    in=servoPos&lt;=maxp &amp;&amp; servoPos&gt;=minp;</span>
<span class="nc" id="L176">    return in;</span>
  }
  
  /**
   * check whether the value is on this Side
   * @param value
   * @return - true if the value is on this Side
   */
  public boolean isValueOnSide(double value) {
<span class="nc" id="L185">    boolean in=false;</span>
<span class="nc" id="L186">    double maxv=Math.max(max.getValue(),min.getValue());</span>
<span class="nc" id="L187">    double minv=Math.min(max.getValue(),min.getValue());</span>
<span class="nc bnc" id="L188" title="All 4 branches missed.">    in=value&lt;=maxv &amp;&amp; value&gt;=minv;</span>
<span class="nc" id="L189">    return in;</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>